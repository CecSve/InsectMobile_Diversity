---
title: "Diversity"
author: "Cecilie S. Svenningsen"
date: "12/11/2020"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(vegan)
```

## Richness analysis

Analysis on max land cover and on >=60% cover. Initially, analysis were performed on the land cover that was most dominant on the route the samples was collected (hence, with varying proportions). This is the first analysis. I then build on what Lauren Nichols has done, by carrying out analysis on the >=60% land cover (also only forest, urban and farmland and a mix hereof). Note that I carry out the analysis on the 1000 m buffer, where Lauren carried out the analysis on the 250 m buffer.

## Maximum land cover of urban, farmland and forest

Load data
```{r load data}
allInsects_totasvs <- read.csv("H:/Documents/Insektmobilen/Analysis/InsectMobile_Diversity/cleaned-data/allInsects_totasvs.txt", row.names=1, sep="")

allInsects_totsample <- read.csv("H:/Documents/Insektmobilen/Analysis/InsectMobile_Diversity/cleaned-data/allInsects_totsample.txt", sep="")

taxonomy_Insecta <- read.delim("H:/Documents/Insektmobilen/Analysis/InsectMobile_Diversity/cleaned-data/DK_taxonomy_Insecta.txt")

allInsects <- allInsects_totsample
asvs <- allInsects_totasvs
```

## Prepare data max land cover

How many species are there in the samples?
```{r}
envvar <- c("Forest_1000", "Agriculture_1000", "Urban_1000")
site_type <- allInsects %>% filter(maxLand_use %in% envvar) %>% select(SampleID, maxLand_use)
keep <- site_type$SampleID
otus <- subset(asvs, select=keep)

pa <- decostand(otus, method = "pa")
tpa <- t(pa)
sppr <- specnumber(tpa)
```

Analysis of variance
```{r}
sppr_aov <- aov(sppr ~ maxLand_use, data = site_type)
summary(sppr_aov)

sppr_df <- sppr %>% 
  enframe() %>% 
  full_join(site_type, by = c("name" = "SampleID"))

sppr_df <- sppr_df %>% mutate(
  maxLand_use = fct_relevel(
    maxLand_use,
    "Urban_1000",
    "Agriculture_1000",
    "Forest_1000")) 

table(sppr_df$maxLand_use)
```


## Including Plots

Box-plots of richness
```{r maxlandcover, echo=TRUE}
landuseCols <- c("#CC79A7", "#E69F00", "#D55E00", "#56B4E9", "#009E73", "darkgrey") 

plot_sppr <- ggplot(sppr_df, aes(x = maxLand_use, y = value, fill = maxLand_use)) +
  geom_boxplot() +
  scale_fill_manual(values = landuseCols[c(1,2,5)]) +
  scale_x_discrete(labels = c("Urban \n (n = 36)", "Farmland \n (n = 279)", "Forest \n (n = 45)")) +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.background = element_rect("white"),
        panel.grid = element_line("grey90"),
        axis.line = element_line("gray25"),
        axis.text = element_text(size = 12, color = "gray25"),
        axis.title = element_text(color = "gray25"),
        legend.text = element_text(size = 12)) + 
  labs(x = "Land cover",
       y = "Number of species per site",
       title = "Richness")
plot_sppr
```

## Land cover >=60% at the 1000 m buffer

Based on Lauren's script

```{r}
met <- allInsects
met$hab60 = 'Mix'
met$hab60[met$Agriculture_1000>=.6]<-'Agriculture60'
met$hab60[met$Forest_1000>=.6]<-'Forest60'
met$hab60[met$Urban_1000>=.6]<-'Urban60'

pa <- decostand(asvs, method = "pa")
tpa <- t(pa)
sppr <- specnumber(tpa)

site_type <- met %>% select(SampleID, hab60)

sppr_aov <- aov(sppr ~ hab60, data = site_type)
summary(sppr_aov)

sppr_df <- sppr %>% 
  enframe() %>% 
  full_join(site_type, by = c("name" = "SampleID"))

sppr_df <- sppr_df %>% mutate(
  hab60 = fct_relevel(
    hab60,
    "Urban60",
    "Agriculture60",
    "Forest60",
    "Mix")) 

table(sppr_df$hab60)
```

## Including Plots

Box-plots of richness
```{r landcover60, echo=TRUE}
plot_sppr_lauren <- ggplot(sppr_df, aes(x = hab60, y = value, fill = hab60)) +
  geom_boxplot() +
  scale_fill_manual(values = landuseCols[c(1,2,5,6)]) +
  scale_x_discrete(labels = c("Urban \n (n = 10)", "Farmland \n (n = 182)", "Forest \n (n = 6)", "Mix \n (n = 166)")) +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.background = element_rect("white"),
        panel.grid = element_line("grey90"),
        axis.line = element_line("gray25"),
        axis.text = element_text(size = 12, color = "gray25"),
        axis.title = element_text(color = "gray25"),
        legend.text = element_text(size = 12)) + 
  labs(x = "Land cover",
       y = "Number of species per site",
       title = "Richness")
plot_sppr_lauren
```
